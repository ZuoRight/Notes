# AMM

去中心化交易所通常无需 KYC 验证，通常加密货币钱包连接，与链上合约直接进行交互

在中心化交易所中，采用订单薄模式，由做市商来提供流动性与报价，而 DEX 通常使用 AMM 实现

AMM 是一种智能合约，通过预设的数学公式自动为交易对提供流动性

![20240703232333](https://image.zuoright.com/20240703232333.png)

![20240703221138](https://image.zuoright.com/20240703221138.png)

- 恒定资产比例池：两种资产的价值比例为 1:1，UniSwap
- 混合资产池：支持 3 种及以上资产，Curve，专注于稳定币 Swap
- 加权池：多种资产比例，Balancer

## AMM 模型

- 恒定和做市商(CSMM) $x + y = k$

![20240703222954](https://image.zuoright.com/20240703222954.png)

- 恒定乘积做市商(CPMM) $x * y = k$，比如 UniSwap

![20240703223031](https://image.zuoright.com/20240703223031.png)

- 恒定平均值做市商(CMMM)
- 混合常数函数做市商(CFMM)：CSMM + CPMM，比如 Curve，使无常损失最小化

$(x * y * z)^{1/3} = k$

![20240703223404](https://image.zuoright.com/20240703223404.png)

## 无常损失 Impermanent Loss

由于资产在 CEX 的价格发生变化，或者供需关系产生 Swap，导致流动性池中的资产也会跟着变化

这个过程就有可能产生损失（Loss），但价格还可能波动回来，所以损失是暂时的（Impermanent）

比如在 UniSwap 的 ETH/USDT 池中提供流动性，此时 ETH 的 价格为 `$200`，需存入 0.5 ETH 和 100 USDT，恒定乘积 $k = 0.5*100 = 50$

假设 ETH 价格上涨到 `$400`，USDT 的价格不变，还是 `$1` ，AMM 会自动减少池中 ETH 的数量，增加 USDT 的数量，以此保持乘积恒定：$50 = x' * y'$，因为两种资产的价值比例要始终保持 1:1，即 $x'*400 = y'*1$，综合两个公式可计算出 ETH 约 0.354 个，USDT 约 141.6 个，共计价值 `$283.2`，如果没有提供流动性，则现在总价值应该是 $0.5*400 + 100 = 300$，如果此时撤出流动性相当于损失了 `$16.8`（忽略 Gas 费和提供流动性带来的收益）

也就是说提供流动性，会随着币价的波动，升值的资产越来越少，贬值的资产越来越多，如果币价不断下跌，就会导致流动性枯竭，池子里只剩下一堆没有价值的资产
