# 数据链路&物理层

## 节点

- 主机：电话、打印机、电脑、服务器
- 网络中间件：路由器等网关
- 软件程序

## 网络设备

![20230519205325](https://image.zuoright.com/20230519205325.png)

- [集线器，交换机，路由器的区别](https://www.bilibili.com/video/BV1yt411d7Rd)
- [搞懂路由器，集线器，交换机，网桥，光猫有啥区别](https://golangguide.top/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86%E7%82%B9/%E7%A1%AC%E6%A0%B8%E5%9B%BE%E8%A7%A3%EF%BC%8130%E5%BC%A0%E5%9B%BE%E5%B8%A6%E4%BD%A0%E6%90%9E%E6%87%82%EF%BC%81%E8%B7%AF%E7%94%B1%E5%99%A8%EF%BC%8C%E9%9B%86%E7%BA%BF%E5%99%A8%EF%BC%8C%E4%BA%A4%E6%8D%A2%E6%9C%BA%EF%BC%8C%E7%BD%91%E6%A1%A5%EF%BC%8C%E5%85%89%E7%8C%AB%E6%9C%89%E5%95%A5%E5%8C%BA%E5%88%AB%EF%BC%9F.html)

### 网卡 NIC

原本是插在主板上的网络接口卡，简称网卡（NIC, Network Interface Card），现在基本嵌入集成到主板中了，所以叫做网络适配器更合适，但叫网卡更简单易懂

- 网卡和计算机之间通信，通过主板上的 I/O 总线以并行方式传输
- 网卡和局域网之间通信，通过传输介质以串行方式传输

适配器装有 RAM 和 ROM，操作系统中需要安装适配器驱动，计算机和局域网的传输方式不同，所以需要对传输方式进行转换，传输速率也不同，所以需要实现缓存功能，还需要实现以太网协议

适配器出厂时会在 ROM 中固化一个全球唯一的硬件地址，又称物理地址，或 MAC 地址，类似于身份证号，仅用于同网段局域网内定位，出了网关还得靠 IP 地址路由

![20230518162437](https://image.zuoright.com/20230518162437.png)

### 集线器 Hub

是一个具有多个端口的设备，工作在物理层，常见于经典以太网中的星型网络拓扑，用于网络设备的互连

不会过滤任何数据，也不知道数据要发送到哪里，当数据包到达某个端口时，集线器会复制数据包然后无脑转发给所有其它端口，所以不仅不安全，而且会造成不必要的流量，浪费带宽

内部结构

![20241229234400](https://image.zuoright.com/20241229234400.png)

### 网桥 Bridge

网桥，也叫桥接器，工作在数据链路层，本质上可以理解为两个网线口的交换机，能将一个大的 LAN 分割为多个网段，或将两个以上的 LAN 互联为一个逻辑 LAN，使 LAN 上的所有用户都可访问服务器

还可以连接处在不同网络类型的主机，比如 Host 使用无线网卡，虚拟机 Guest 的虚拟网卡通常是以太网卡，就需要网桥连接

### 交换机 Switch

交换机其实就是多网线口的网桥，可以把多台电脑给连接起来，来替代集线器，工作在数据链路层

交换机可以识别和存储设备的 MAC 地址，可以将数据包发送给指定的端口，还可实现 MAC 地址过滤、VLAN、QoS 等额外功能

![20241229234706](https://image.zuoright.com/20241229234706.png)

通过生成树协议（STP）用来解决环路问题

交换机以特定的网络拓扑将不同的有线设备连接在一起组成有线局域网，即以太网

![20210725150926](https://image.zuoright.com/20210725150926.png)

- 2 层交换机，即通常所说的交换机
- 3 层交换机，多了路由功能，但不能跨异类子网，主要用于跨 VLAN 路由
- 4 层交换机，可以识别传输层协议获取 TCP 或 UDP 端口号，进而通过端口号过滤流量或设置转发优先级

### 路由器 Router

集线器和交换机都没有路由功能，只能用于在局域网内交换数据，而外网交换数据就需要路由器

路由器集成多张网卡，拥有 IP 地址，根据数据包的 IP 地址决定是否接受还是路由到另一个网络，兼具了交换机、桥接器、中继器的功能

路由器本质上是一个网络的网关（Gateway）

> 网关只是一个逻辑概念，连接异种网络需要网关来转译各种协议，分布于各层的中间设备都可能起到网关的作用，但通常所说的网关是指网络层的路由器

![20230518082748](https://image.zuoright.com/20230518082748.png)

网口：千兆网口、2.5G 网口

---

无线路由器

频段：

- 2.4 GHz，频率低，波长长，传输速度慢，干扰设备多，但绕墙能力强
- 5 GHz，频率高，波长短，传输速度快，干扰设备少，但绕墙能力弱

双频路由器可同时发出以上两个频段的信号，通常所说的千兆路由器，是指两个频段的协商速率总和超过千兆，而不是外网的速度

双频合一

```text
两个不同频段的 WiFi 名称会合为一个，WiFi 信号强的时候自动连接到 5 GHz 信号，信号弱的时候连到 2.4 GHz 的信号
但可能切换不及时，并且切换的时候会出现断连，而且不知道到底连的是什么
所以通常 2.4 GHz 用来连智能家居，手机电脑等连接到 5 GHz
```

WiFi 协议

- WiFi 6 同时只能接收一个频段的信号
- WiFi 7 多链路运行，可实现更高的传输速度，但需要路由器和手机等都支持 WiFi 7 才行

国内规定了路由器芯片的发射功率不能超过 100mW，所以有人会刷国际版固件，将地区改为澳大利亚等来调高功率，会使得信号变强。

路由器的天线可以改变 WiFi 的传播方向，但无法改变信号的功率，而且路由器用的基本都是全向天线，所以并不是指哪打哪，而是水平方向信号最强

改变路由器的摆放位置让其穿墙少绕几次，比摆弄天线作用更明显

## 路由

数据经过路由器转发的过程称为「路由」，网络中相互连接的两个节点之间的通信可以通过许多不同的路径进行

查看路由过程：`tracert baidu.com`

### 路由协议

使用一些预定规则选取最佳路径

- BGP 协议：基于 TCP 协议，根据距离矢量路由算法(Bellman-Ford)，找到最短路径，主要用于内网
- OSPF 协议，基于 IP 协议，根据链路状态路由算法(Dijkstra)，找到最佳路径，主要用于外网

### 路由表

- 静态全局路由表

互联网诞生初期，全球的主机很少，只需要每个路由器各自维护一张包含全球全局路由表即可，当有新的路由器出现，需要各自手动更新路由表

- 动态全局路由表

随着互联网规模增长，改为自动更新全局路由表

- 动态分级路由表

互联网流量暴涨，全局路由表越来越大，更新与查询越来越频繁，越来越慢，于是引入分级路由，将互联网按区域大小用树状层次结构划分，每个路由器只需要维护所在区域的路由表即可

### 软路由

通常所说的路由器，是厂商基于自行开发或是开源的嵌入式设备操作系统，根据特定的硬件设备，设计出来的传统硬件设备

而软路由是基于软件工具在旧电脑、工控机、开发板、服务器甚至是硬件虚拟机中安装软路由系统，然后通过强大的软件实现各种各样的功能。

软路由通常需要自己组装，性价比更高，可以在软路由上实现离线下载、去广告、QOS、流量控制、多线路控制、链路负载均衡等

常见的软路由系统：个人或家庭常用的 OpenWRT，网吧常用的 RouterOS 等等

软路由的 WiFi 性能非常差，通常需要将其它的硬路由作为 AP 接入到软路由中

![20241230215821](https://image.zuoright.com/20241230215821.png)

## 防火墙

防火墙可以是硬件设备，也可以是软件工具或者云服务

### 应用层防火墙

比如网络应用防火墙 WAF，专门针对 HTTP/HTTPS 流量进行过滤和监控，用于保护 Web 应用程序，防御常见的 Web 攻击，如 SQL 注入、跨站脚本（XSS）、跨站请求伪造（CSRF）等

具备深度包检测（DPI, Deep Packet Inspection）的能力，可以分析出压缩包中的文件

### 网络层防火墙

Linux Kernel 从 2.4 版本起，开放了一套通用的、可供代码干预数据在协议栈中流转的过滤器框架 Netfilter

基于 Netfilter 设计的 Xtables 系工具，比如 `iptables`，可以配置去实现原本用 Netfilter 编码才能做到的事情。

> firewalld 是 iptables 的一个封装，可以更容易地管理 iptables 规则

- 四(规则)表：`filter`、`nat`、`mangle`、`raw`
- 五(规则)链：`INPUT`、`OUTPUT`、`FORWARD`、`PREROUTING`、`POSTROUTING`

### 其它

IDS（Intrusion Detecion System）入侵检测，也需要具备 DPI 的能力，但是用旁路部署，类似于电路并联，而防火墙是串联

GFW（Great Firewall），不是防火墙，部署和工作方式类似于 IDS，但功能更多

## 连接 ISP 的方式

用户需要连到 ISP 来接入互联网，客户数据包进入 ISP 网络的位置称为 ISP 存点（POP，Point of Presence），不同存点间采用数据包交换技术传输，完全是数字化的

![20230512172856](https://image.zuoright.com/20230512172856.png)

ISP 运营商要利用以太网接入互联网，需要使用 PPPoE(PPP over Ethernet) 协议作用户认证，即拨号上网（dial-up）

宽带（broadband）的定义尚无统一定义，一般指下行速率大于 25Mbit/s，上行速率大于 3Mbit/s，分为有线宽带和无线宽带

### 数字用户线路，重用电话系统

DSL, Digital Subscriber Line，数字用户线路是通过现有的电话线系统提供互联网连接

通过电话分离器将电话信号（0～4kHz）与数字信号（高端频谱）分开，然后数字信号经过调制解调器被转成模拟信号传输

![20230517131855](https://image.zuoright.com/20230517131855.png)

DSLAM（数字用户线路调制解调器），又称接入端单元(ATU)，ATU-C 表示电话局，ATU-R 表示用户端

![20230517130924](https://image.zuoright.com/20230517130924.png)

非对称数字用户线（ADSL, Asymmetric Digital Subscriber Line）技术是用数字技术对现有的模拟电话用户线进行改造，使其能够承载宽带数字业务

非对称指下行和上行带宽不一致，因为客户端使用互联网的场景主要是下载各种文档，而上传信息量较小，所以下行带宽远大于上行，所以不适用与服务端，服务端通常采用对称光纤连接（SDSL）

缺点：速度相对较低，距离电话交换机越远，速度越慢

### 同轴电缆，重用有线电视系统

旧的有线电视网最高传输速率为 450MHz，仅用于电视信号下行，将电视网主干部分的同轴电缆改为光纤，变为现在的光纤同轴混合(HFC)网，扩宽了传输频带，并支持双向传输

模拟电视需要使用机顶盒连接同轴电缆接收数字电视信号，若要接入互联网还需要一个电缆调制解调器，可以是单独的设备，也可以内置在机顶盒内

缺点：带宽共享，用户较多时速度可能下降

### FTTx

光缆（光纤 + 保护层）使用寿命更长，造价低，但维护成本高

- FTTB(Fiber to the Building) 光纤到楼，网线入户，已经逐渐淘汰
- FTTH(Fiber to the Home) 光纤到户，主流
- FTTR(Fiber to the Room) 光纤到室，到每个房间

### 其它

- 蜂窝网络
- 无线网络
- 卫星互联网
