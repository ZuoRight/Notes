# 系统操作

## 用户相关

- 切换用户

```bash
# 将身份切换为其他用户
su - [username]  # 非root用户切换时需要输入对方密码，使用exit可以退回原来的用户
"""
不加username默认切换到root用户
带 - 表示完全切换，即当前路径切换为对方家目录，否则还会留在当前用户的家目录
"""

# 以其他用户的身份执行命令
sudo [-u username] command
"""
需要其它用户授权给你，才可以使用sudo
    可以用visudo命令（vi只有读取权限）编辑/etc/sudoers文件，给用户添加一行与root相同的权限即可

不带usernamem默认切换root用户
加-s可以保持session
"""
```

> 用户相关的很多操作都需要root用户权限

```bash
groupadd group1  # 创建用户组
groupdel group1  # 删除用户组

# 创建用户
useradd [-g group_name] username
"""
-g 指定用户组，否则默认会创建并指定一个与用户同名的用户组
-m 强制建立家目录(一般默认)
-s 指定默认shell
"""

# 删除用户
userdel [-r] username
"""
防止误删，删除后用户的家目录还会保留在/home中
    -r 连同家目录一起删除
"""

# 修改用户信息
usermod username
"""
usermod -g group_new username  修改用户组
usermod -d /home/new_path username  修改家目录存放位置
usermod -s /bin/bash username  修改默认shell
"""

# 设置/修改密码
passwd [username]
"""
密码为空则不需要密码即可登录
root用户可以修改任意用户的密码且不需要输入旧密码
不加username则默认修改当前用户的密码
"""
```

> 每个登录的用户都会获得两个ID：`UID`(User ID) 和 `GID`(Group ID)，root的ID都是0

```bash
# 查看某个用户的账号信息，不带用户名默认查看自己
# 用户不存在则返回no such user，可以用来判断用户是否存在
id [username]
# 查看所属用户组
groups
# 查看当前在线用户
who  # 或者 w
```

## 用户配置文件

- `/etc/passwd`

账号信息存储在`/etc/passwd`文件中，其中很多都是系统账号（系统运行所必须的），不可随意删除

> 其中`/usr/sbin/nologin`表示不允许登陆
>
> 密码为x，表示需要密码，如果为空表示不需要密码

![20210827231927](http://image.zuoright.com/20210827231927.png)

- `/etc/shadow`

> 早期密码存在`/etc/passwd`中，但后来因为安全原因单独存到了：`/etc/shadow`

![20210827233831](http://image.zuoright.com/20210827233831.png)

> 最近修改日期：是从1(1970.1.1)开始累计的，多少天内不可修改或需要修改，为0则表示可任意修改，99999为273年，即不限制

```bash
usermod -chage username  # 修改失效日期，如果想暂停某个用户登录，可以将失效日期改为0
```

- `/etc/group`

用户组配置文件

## 给用户发消息

```bash
write username  # 给某个在线用户发送消息
wall  # 给所有在线用户发送消息
mesg n/y  # 拒绝或允许接收消息，root用户默认拒绝，普通用户无法拒绝root用户发来的消息
mail -s "test content" [chonge@localhost]  # 发送邮件，也可以给离线用户发，给本机用户可以省略[chonge@localhost]，对方可以使用mail命令来接收查看邮件内容
```

![20210828001620](http://image.zuoright.com/20210828001620.png)

![20210828001628](http://image.zuoright.com/20210828001628.png)

## 内存和CPU

```bash
# 查看内存
free [-m]  # 静态
top  # 动态

# 查看CPU
lscpu
"""
Architecture:            x86_64
  CPU op-mode(s):        32-bit, 64-bit
  Address sizes:         46 bits physical, 48 bits virtual
  Byte Order:            Little Endian
CPU(s):                  1
  On-line CPU(s) list:   0
Vendor ID:               GenuineIntel
  Model name:            QEMU Virtual CPU version (cpu64-rhel6)
    CPU family:          6
    Model:               13
    Thread(s) per core:  1
    Core(s) per socket:  1
    Socket(s):           1
    Stepping:            3
    BogoMIPS:            5199.99
    Flags:               fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pse36 clflush mmx fxsr sse sse2 ss syscall nx pdpe1gb rdtscp lm rep_good nopl xtopology cpuid tsc
                         _known_freq pni pclmulqdq ssse3 cx16 pcid sse4_1 sse4_2 x2apic popcnt aes xsave avx f16c rdrand hypervisor lahf_lm pti fsgsbase smep xsaveopt
Virtualization features: 
  Hypervisor vendor:     KVM
  Virtualization type:   full
Caches (sum of all):     
  L1d:                   32 KiB (1 instance)
  L1i:                   32 KiB (1 instance)
  L2:                    4 MiB (1 instance)
  L3:                    16 MiB (1 instance)
NUMA:                    
  NUMA node(s):          1
  NUMA node0 CPU(s):     0
Vulnerabilities:         
  Itlb multihit:         KVM: Mitigation: VMX unsupported
  L1tf:                  Mitigation; PTE Inversion
  Mds:                   Vulnerable: Clear CPU buffers attempted, no microcode; SMT Host state unknown
  Meltdown:              Mitigation; PTI
  Spec store bypass:     Vulnerable
  Spectre v1:            Mitigation; usercopy/swapgs barriers and __user pointer sanitization
  Spectre v2:            Mitigation; Retpolines, STIBP disabled, RSB filling
  Srbds:                 Not affected
  Tsx async abort:       Not affected
"""
```

## 存储

- 块存储

最古老的数据存储形式，性能好，吞吐量高，延迟低。数据都储存在固定长度的一个或多个块（Block）中，想要读写访问数据，就必须使用与存储相匹配的协议（SCSI、SATA、SAS、FCP、FCoE、iSCSI……）来进行。

- 文件存储

便于人类使用和管理，POSIX事实标准，绝大多数传统的文件存储都是基于块存储之上去实现的。

人们把定义文件分配表（FAT，专门组织块结构来构成文件的分配表）应该如何实现、储存哪些信息、提供什么功能的标准称为文件系统（File System），FAT32、NTFS、exFAT、ext2/3/4、XFS、BTRFS 等都是很常用的文件系统。

- 对象存储

是一种随着云数据中心的兴起而发展起来的存储，天生的分布式特性，以及极其低廉的扩展成本，使它很适合于CDN一类的应用，拿来存放图片、音视频等媒体内容，以及网页、脚本等静态资源。

## 文件系统

- ext4
- xfs
- NTFS
