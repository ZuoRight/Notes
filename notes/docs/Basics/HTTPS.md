# HTTPS

https://github.com/youngwind/blog/issues/108
https://mp.weixin.qq.com/s/MfvUuitrF8MN16nxyZNB8A

## 基础知识

公钥加密只能私钥解密
私钥加密只能公钥解密，所以并不会用私钥加密，私钥一般只用来做签名

## 单向认证：客户端对服务端做认证

极客时间刘超专栏

客户端
对称加密

服务端
非对称加密
- 服务端私钥
- 服务端公钥

证书中心/根证书：系统自带、手动安装
作用：用根证书公钥解密CA，得到服务端公钥
- 根证书私钥
- 根证书公钥
- 根证书签名：根证书私钥加密得到

## 劫持/抓包

各大CA机构的公钥是默认安装在操作系统里的，所以不要安装来路不明的操作系统，否则相当于裸奔。
抓包工具正是利用了这一点，比如先把charles的根证书安装到操作系统。

然后由于服务端没有对客户端做认证，所以Charles可以模拟客户端，获取到服务端公钥（用于后面加密随机数），然后自制了一个证书（charles根证书签名，包含的是Charles自己的公钥），发送给了客户端，而客户端是用提前装好的charles根证书做认证，可以通过，于是客户端用Charles的公钥加密生成密钥（随机数）发送，然后Charles截获，用Charles自己的私钥解密，然后再用先前截获的服务器公钥加密，发给服务端。

## 双向认证：客户端和服务端互相认证


## 反抓包策略：SSL-Pinning

1. 客户端内置证书，即在客户端内置仅接受指定域名的根证书，而不接受操作系统或浏览器内置的CA根证书对应的任何证书
2. 客户端内置公钥，为啥会推荐这种呢？抓包工具拿到的是真的服务端公钥啊，所以锁定的意义？难道不需要通过证书通信了？

## 突破SSL-Pinning

https://zhuanlan.zhihu.com/p/60392573

内置证书或者公钥的时候，需要对比验证客户端和服务端的证书或公钥，一般是通用的API，所以可以直接控制这个API的返回结果让验证通过。

1. Xposed+justTrustme：不行？

2. 使用逆向神器Frida：太难？
https://blog.csdn.net/xiaohua_de/article/details/80259920

使用模拟器（首选逍遥模拟器）

模拟器不行，使用真机，需要root，root工具（首选刷机精灵）

3. apk反编译工具
