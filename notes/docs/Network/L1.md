# 物理层

物理层的主要任务就是确定与传输媒介的接口有关的一些特性，如机械特性、电气特性、功能特性和过程特性

## 电磁波

![20230517105307](http://image.zuoright.com/20230517105307.png)

电磁波是指相同振荡且相互垂直的电场与磁场，在空间中以波的形式传递能量和动量

电磁波不需要介质进行传播，在真空中的传播速度为光速，人眼可接收到的电磁波称之为可见光，波长大约在380～780nm

> 关于以太：早期科学家认为波一般需要介质才能传输，比如空气之于声波，水之于水波等，所以就假设一种叫做以太的物质是电磁波的传输介质，但无法证明所以被摒弃，但以太这个名字被用于命名了以太网等

- 低频(LF)
- 短波：中频(MF)、高频(HF)
- 微波：甚高频(VHF)、特高频(UHF), 超高频(SHF)、极高频

## 信号

- 信息 message，文字图片音频视频等
- 数据 data，使用特定符号序列表示的信息
- 信号 signal，电气或电磁形式的数据
  > 数字信号/离散信号：信号源产生的原始电信号，也叫基带信号  
  > 模拟信号/连续信号：载波调制后的信号，也叫带通信号

基带信号，即基本频带信号，包含很多低频，需要经过调制（modulation）才能远距离传输，有两种调制方式：基带调制、带通调制

![20230516155718](http://image.zuoright.com/20230516155718.png)

### 基带调制

不同离散值的基本波形称之为码元，可以用两种不同的码元表示二进制数字0和1

基带调制，也叫编码，仅变换基带信号的波形，使其适应信道的特性，变换后依然是基带信号

![20230516163043](http://image.zuoright.com/20230516163043.png)

### 带通调制

带通调制，即利用载波，通过调制解调器将基带信号调制成特定带宽的高频信号，调制后为模拟信号，使其能在一段频率范围内通过信道，所以也叫带通信号，采用频分复用技术实现宽带传输，然后在接收端又将它解调回基带信号

![20230516163609](http://image.zuoright.com/20230516163609.png)

为了达到更高效的传输速率，通常采用更复杂的混合调制，比如正交振幅调制等

## 信道 Channel

信道，即传送信息的通道

- 物理信道
  > 有线信道：双绞线、同轴电缆、光纤等  
  > 无线信道：微波通信、电台广播、卫星通信等  
  > 存储信道：通过硬盘等存储介质从某处向某处转移数据
- 逻辑信道：抽象的信道，用于研究某一层问题时，可以把同一层当作一个逻辑信道

信道的传输模式

- 单工(simplex)：只能单向传输，一条信道，比如电台广播，信号只能从电台发给收音机，而收音机不能向电台发送信号，有时单工也用于表示双向交替通信，注意区分
- 半双工(half-duplex)：可以双向，两条信道，但不能同时传输，比如独木桥、单轨铁道
- 全双工(full-duplex)：可以双向同时传输，两条信道，互不干扰，比如光纤

多路复用

- 频分多路复用FDM(Frequency Division Multiplexing)：不同线路占用不同的频率，比如电台广播
- 时分多路复用TDM(Time Division Multiplexing)：类似十字路口红绿灯
- 波分多路复用WDM(Wavelength Division Multiplexing)：光的频分复用
- 码分多路复用CDM(Code Division Multiplexing)：线路间采用不同的编码方式使得端点可以在同一时间同一频段发送数据，CDMA(码分多址)就是这个思路

## 传输媒介

### 引导型

导引电磁波沿着固体媒介传播

- 架空明线（裸铜线或铁线）
- 双绞线，也叫对称电缆，主要用于固定电话和局域网，两端使用RJ-45插头
- 同轴电缆，主要用于有线电视网
- 光缆，主要用于骨干网

### 非引导型

- Wi-Fi
- NFC
- Bluetooth

## 网络设备

连接异种网络需要网关（gateway）来转译各种协议，网关只是一个逻辑概念，分布于各层的中间设备都可能起到网关的作用，但通常所说的网关是指3层网关

- 业务层
  > 应用防火墙，少数防火墙处于7层，具备深度包检测（DPI, Deep Packet Inspection）的能力，用于分析应用层协议的内容，比如可以分析出压缩包中的文件
  >
  > 入侵检测（IDS, Intrusion Detecion System），也需要具备DPI的能力，但是用旁路部署，类似于电路并联，而防火墙是串联
  >
  > GFW（Great Firewall），不是防火墙，部署和工作方式类似于IDS，但功能更多
- 传输层
  > 4层交换机，可以识别传输层协议获取TCP或UDP端口号，进而通过端口号过滤流量或设置转发优先级
  >
  > 状态防火墙，通常防火墙指的是4层防火墙，可以完全处理 TCP 协议的状态
- 网络层
  > 路由器（router），兼具了交换机、桥接器、中继器的功能，集成多张网卡，拥有IP地址、可读取其它主机IP地址并路由，用于外网交换数据
  >
  > 3层交换机，它比2层交换机多了路由功能，但不能跨异类子网，主要用于跨 VLAN 路由
  >
  > 无线热点，接入点(AP, Access Poit)，如果热点有路由功能就是无线路由器，否则就属于2层的网桥
- 数据链路层
  > 网络交换机（network switch），交换机的种类有很多，通常指2层交换机，主要用于快速以太网，替代功能弱性能差的集线器，通过生成树协议(STP)用来解决环路问题，交换器可识别MAC地址转发给对应目标即可，而不需要全部转发，还可实现MAC地址过滤、VLAN、QoS等额外功能，但是没有路由功能
  >
  > 网桥（network bridge），类似交换机，但可以连接处在不同网络类型的主机，比如Host使用无线网卡，虚拟机Guest的虚拟网卡通常是以太网卡，就需要网桥连接  
- 物理层
  > 中继器（repeater），信号在物理媒介中传输会出现衰减，无论有线还是无线，中继器用于增强信号，比如微波通讯只能直线传播，而地球有弧度，所以需要建设微波塔
  >
  > 集线器（hub），常见于经典以太网中的星型网络拓扑，只能无脑转发广播，通过双绞线或光纤连接网卡或调制解调器，另外 USB Hub 也属于USB线这种通信媒介的集线器
  >
  > 调制解调器（model）

> [集线器，交换机，路由器](https://www.bilibili.com/video/BV1yt411d7Rd)

![20230519205325](http://image.zuoright.com/20230519205325.png)

## 节点

- 主机：电话、打印机、电脑、服务器
- 网络中间件：路由器等网关
- 软件程序

当两个以上通信节点构成一个网络时，节点间通信会涉及如下几种方式

- 广播(broadcast)：发给所有端点
- 多播(multicast)：发给指定的多个端点，以前也叫组播
- 单播(unicast)：发给指定的单个端点
- 选播(anycast)：发给随机的单个端点

## 连接ISP的方式

用户需要连到ISP来接入互联网，客户数据包进入 ISP 网络的位置称为 ISP 存点(POP，Point of Presence)，不同存点间采用数据包交换技术传输，完全是数字化的

![20230512172856](http://image.zuoright.com/20230512172856.png)

ISP 运营商要利用以太网接入互联网，需要使用 PPPoE(PPP over Ethernet) 协议作用户认证，即拨号上网（dial-up）

### 重用电话系统

利用调制解调器将数字信号转成模拟信号传输比特

非对称数字用户线（ADSL, Asymmetric Digital Subscriber Line）技术是用数字技术对现有的模拟电话用户线进行改造，使其能够承载宽带（broadband）数字业务

非对称指下行和上行带宽不一致，因为客户端使用互联网的场景主要是下载各种文档，而上传信息量较小，所以下行带宽远大于上行，所以不适用与服务端，服务端通常采用对称的SDSL

宽带的定义尚无统一定义，一般指下行速率大于25Mbit/s，上行速率大于3Mbit/s，分为有线宽带和无线宽带

![20230517130924](http://image.zuoright.com/20230517130924.png)

DSLAM 数字用户线接入器，包括很多ADSL调制解调器，又称接入端单元(ATU)，ATU-C 表示端局，ATU-R 表示远端，即用户端

通过电话分离器将电话信号（0～4kHz）与数字信号（高端频谱）分开

![20230517131855](http://image.zuoright.com/20230517131855.png)

### 重用有线电视系统

旧的有线电视网最高传输速率为450MHz，仅用于电视信号下行，将电视网主干部分的同轴电缆改为光纤，变为现在的光纤同轴混合(HFC)网，扩宽了传输频带，并支持双向传输

模拟电视需要使用机顶盒连接同轴电缆接收数字电视信号

若要接入互联网还需要一个电缆调制解调器，可以是单独的设备，也可以内置在机顶盒内

### FTTx

FTTH(Fiber to the Home) 光纤入户，即光纤直接铺到家里才把光信号转为电信号，可以获得最高的上网速率

但 FTTH 价格较高，另外大多数家庭并没有这么高的需求，所以可以退而求其次，可以将接入点放到家外有一定距离的地方，使得多个家庭共用一根光纤，比如到小区，到楼层等等，统一用 FTTx 表示

## 网络分类

### 互联网

互联网使用 ISP 网络连接各种各样的网络

按照规模大小通常可分为三级：骨干网（Backbone Network）、地区网、校园网/企业网/小区网

不同规模的 ISP 骨干网之间通过互联网交换点（IXP, Internet eXchange Point）连接交换数据，相互连接的ISP彼此是对等的（Peer），最顶级的 ISP 称之为 1 级 ISP。

![20230512153113](http://image.zuoright.com/20230512153113.png)

按用途划分

- 公用网，即电信公司建造的大型网络
  > 中国电信互联网 CHINANET  
  > 中国联通互联网 UNINET  
  > 中国移动互联网 CMNET  
  > 中国教育和科研计算机网 CERNET  
  > 中国科学技术网 CSTNNET
- 专用网，为满足某个部门或机构而建造的专用网络，比如军队、铁路、银行、电力等

星际互联网（Interplanetary Internet）：跨越太空把网络连接起来

### 广域网

WAN, Wide Area Network

通常为跨地区或者国家通信，比如某公司分布式办公，不同地区的主机间通过路由器和通信线路通信，组成通信子网

网络服务由互联网服务提供商（ISP, Internet Service Provider）运营

![20210725150016](http://image.zuoright.com/20210725150016.png)

大ISP自己建造通信线路，小ISP则向电信公司租用通信线路

主机必须有IP才能上网，机构和个人向某个ISP交纳规定的费用，即可从该ISP获取所需IP地址的使用权，便可通过该ISP提供的子网接入到互联网

蜂窝/移动网络（Cellular / Mobile Network）是采用了无线技术的广域网

- 2G
  > GSM 全球移动通信系统  
  > GPRS 通用数据包无线业务  
- 3G
  > UMTS 通用移动通信系统：WCDMA（宽带码分多址）、CDMA（码分多址）  
  > HSPA  
- 4G: LTE、LTE-A  
- 5G: NR

接入点为基站，基站间通过有线的骨干网连接在一起

### 城域网

MAN, Metropolitan Area Network

![20230512231928](http://image.zuoright.com/20230512231928.png)

### 局域网

LAN, Local Area Network

- 有线局域网
  > 淘汰：令牌环、FDDI、ARCNET  
  > 现在：基于 IEEE 802.3 标准的以太网(Ethernet)  
- 虚拟局域网 VLAN(Virtual ~) 主要用于逻辑分组  
- 无线局域网 WLAN(Wireless ~)
  > 基于 IEEE 802.11 标准的 Wi-Fi  
- 存储网 SAN(Storage Area Network)，通常专用于服务器访问数据存储设备

无线设备通过无线路由器等接入点连接到有线网络

![20230512112432](http://image.zuoright.com/20230512112432.png)

交换机以特定的网络拓扑将不同的有线设备连接在一起组成有线局域网，即以太网，可以将物理局域网分成不同的逻辑局域网，即虚拟局域网

![20210725150926](http://image.zuoright.com/20210725150926.png)

### 个域网

PAN, Persinal Area Network

个人的电子设备间连接起来的网络，通常采用无线技术，所以也叫 WPAN（Wireless ～）

- 蓝牙
- USB
- 红外
- NFC

### 体域网

BAN, Body Area Network

主要指无线传感器网络

无线射频识别(RFID，Radio Frequency IDentification)技术则可以让日常物品也成为计算机网络的一部分

## 防火墙

- 硬件防火墙：防御（比如DDS攻击），兼顾软件数据包过滤功能
- 软件防火墙：数据包过滤，是否允许某个 IP 或者端口进入主机或者转发等，又可以分为包过滤防火墙和应用防火墙

从 Linux Kernel 2.4 版开始，内核开放了一套通用的、可供代码干预数据在协议栈中流转的过滤器框架 Netfilter，基于 Netfilter 设计的 Xtables 系工具，比如 `iptables`。

iptables 的价值便是以配置去实现原本用 Netfilter 编码才能做到的事情。

- 四(规则)表：`filter`、`nat`、`mangle`、`raw`
- 五(规则)链：`INPUT`、`OUTPUT`、`FORWARD`、`PREROUTING`、`POSTROUTING`

<https://iswbm.com/751.html>
